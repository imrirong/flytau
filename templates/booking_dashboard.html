{#
  booking_dashboard.html

  This page displays booking details (including reserved seats and total price) after a user searches
  for a booking. If the booking is Active, it allows cancellation via a link with a confirmation prompt.
#}

{% extends "layout.html" %}

{% block title %}לוח הזמנות - FLYTAU{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow mt-4" dir="rtl">
            <div class="card-header bg-primary text-white text-end">
                <h4 class="mb-0">לוח הזמנות</h4>
            </div>

            <div class="card-body text-end">

                {% if booking %}
                    <div class="alert alert-success">
                        <strong>נמצאה הזמנה!</strong>
                    </div>

                    <div class="card mb-3">
                        <div class="card-body">
                            <p><strong>מספר הזמנה:</strong> {{ booking.booking_id }}</p>
                            <p><strong>מספר טיסה:</strong> {{ booking.flight_id }}</p>
                            <p><strong>מסלול:</strong> {{ booking.origin }} → {{ booking.destination }}</p>

                            <p><strong>תאריך ושעה:</strong> {{ booking.departure_date }} {{ booking.departure_time }}</p>

                            <p class="mb-2"><strong>מושבים שהוזמנו:</strong></p>

                            {% if seats and seats|length > 0 %}
                                <div class="d-flex flex-wrap gap-2 mb-3" dir="ltr">
                                    {% for s in seats %}
                                        <span class="badge bg-light text-dark border">
                                            {{ s.row_num }}{{ s.col_num }} ({{ s.class }})
                                        </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="alert alert-warning mb-3">
                                    לא נמצאו מושבים להזמנה זו.
                                </div>
                            {% endif %}

                            <p><strong>מחיר כולל:</strong> {{ booking.total_price }}₪</p>
                        </div>
                    </div>

                    {% if booking.booking_status == 'Active' %}
                        <a href="{{ url_for('cancel_booking', booking_id=booking.booking_id) }}"
                           class="btn btn-outline-danger w-100"
                           onclick="return confirm('שים לב: ביטול שנעשה יותר מ-36 שעות לפני הטיסה כרוך בעמלה של 5%. לא ניתן לבטל פחות מ-36 שעות לפני הטיסה. האם להמשיך?');">
                            בטל הזמנה
                        </a>
                    {% else %}
                        <button class="btn btn-secondary w-100" disabled>לא ניתן לבצע פעולות</button>
                    {% endif %}

                {% elif searched %}
                    <div class="alert alert-warning">
                        לא נמצאה הזמנה עם הפרטים שהוזנו.
                    </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>
{% endblock %}
